<html>
<link>
<meta charset="utf-8" />
<title>景點與道路分析</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<head>

  
  <link rel="icon" type="image/x-icon" href="user.png">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  </link>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  
  <!-- icon -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
  <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css" />
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css" />
  <!-- heatjs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>
  <!-- mytool -->
  <script src="final_tool2.js" ></script>
  <link rel="stylesheet" href="final.css">

  <style>

  </style>
</head>

<body>
  <div class="button-container button-top">
    <button class="btn btn-primary mybtn" onclick="updateDate('VD', '交通')">更新交通資料</button>
    <button class="btn btn-success mybtn" onclick="updateDate('spot', '景點')">更新景點資料</button>
    <button class="btn btn-warning mybtn" onclick="updateDate('CCTV', '監視器')">更新監視器資料</button>
  </div>

  <div class="canvas-container button-top">
    <button class="btn btn-light  toggleButton"  >▶</button>
  </div>

  <div id="showbox" class="canvas-container hidden showbox button-top">
    <div style="text-align: center;font-weight: bold;font-size: 32px;" >最近的景點</div>
    <div style=" display: flex;    align-items: center;    justify-content: space-between;margin-top: 5px;">
    <div class="attraction-info button-top">
      <table  id="myTable">
        <thead>
          <tr>
            <th><strong>景點名稱</strong></th>
            <th style="width:70px"><strong>距離</strong></th>
          </tr>
        </thead>
        <tbody>
        
        </tbody>
      </table>
    </div>
    <div >
      <button class="btn btn-light mybtn toggleButton">✖</button>
    </div>
  </div>
  </div>


  <div id="map"></div>

  <script>
    // 初始化地圖
    var map = L.map('map').setView([23.800983, 120.772569], 8);

    

    // 添加地圖圖層
    var baseLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);


    var currentMarker = null;

    var CCTV_Group = L.featureGroup();
    var attraction_Group = L.featureGroup();
    var activity_Group = L.featureGroup();
    var scenic_Group = L.featureGroup();
    var highway_Group = L.featureGroup();
    var show_Group = L.featureGroup();

    var heatLayer = L.featureGroup();


    var showdata = [];
    
    var all_lat=0;
    var all_lon=0;


    var overlays = {
            "縣市監視器": CCTV_Group,
            "高速公路監視器": highway_Group,
            "景點": attraction_Group,
            "風景": scenic_Group,
            "景點活動":activity_Group,

        };

        Object.values(overlays).forEach(layer=> {
            map.addLayer(layer)
            // 你可以在这里对 layerGroup 进行更多处理
        })
    var layersControl = L.control.layers(null, overlays,{collapsed:false}).addTo(map);

    //針對地圖增加點擊行為
    map.on('click' ,(e)=> {
      clickSearch(e);
      setTimeout(()=>parseRecommand(), 1500);
    });

    //setInterval(()=>(updateHeatmap()), 3000)

    const colors = ["#575757", "#a3a3a3", "#f69730", "#38aadd", "#73af26"];

    // 選擇目標div中的所有span元素
    const labels = document.querySelectorAll('.leaflet-control-layers-overlays label');

    // 為每個span元素設置背景顏色
    labels.forEach((span, index) => {
        // 使用模運算符確保顏色陣列中的顏色循環使用
        span.style.backgroundColor = colors[index % colors.length];
    });
  

// 添加點擊事件監聽器
const toggleButton = document.getElementsByClassName('toggleButton');
const box = document.getElementById('showbox');
const table = document.getElementById("myTable");
const tbody = table.querySelector("tbody");

const buttontoggle = ()=>{
  // 檢查 box 的顯示狀態
  if (box.classList.contains('hidden')) {
    // 如果 box 是隱藏的，則顯示它
    box.classList.remove('hidden');
  } else {
    // 如果 box 是顯示的，則隱藏它
    box.classList.add('hidden');
  }
}

toggleButton[0].addEventListener('click', buttontoggle) 
toggleButton[1].addEventListener('click', buttontoggle) 

    

 
  </script>
</body>

</html>